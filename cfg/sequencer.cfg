# Example of a configuration file for the On-Site Analysis (OSA) for
# the LST1 telescope.
#
# The %()s variables are wildcards for string substitutions

[LST1]
# Directories to replicate the LST1 directory tree.
# The BASE and MONITORING need to be set by the user.
BASE: test_osa/test_files0
MONITORING: extra/monitoring
# The directories below can be left untouched.
R0_DIR: %(BASE)s/R0
DRIVE_DIR: %(MONITORING)s/DrivePositioning
RUN_SUMMARY_DIR: %(MONITORING)s/RunSummary
ANALYSIS_DIR: %(BASE)s/running_analysis
CALIB_DIR: %(BASE)s/calibration 
PEDESTAL_DIR: %(BASE)s/calibration
TIMECALIB_DIR: %(BASE)s/calibration
DL1_DIR: %(BASE)s/DL1
DL1AB_DIR: %(BASE)s/DL1
MUON_DIR: %(BASE)s/DL1
DATACHECK_DIR: %(BASE)s/DL1
DL2_DIR: %(BASE)s/DL2
DL3_DIR: %(BASE)s/DL3
CLOSER_DIR: %(BASE)s/OSA/Closer

# To be set by the user. Using PROD-ID will overcome the automatic
# fetching of lstchain version. Otherwise leave it empty.
PROD_ID: v0.1.0
CALIB_PROD_ID: v01
# Change this to produce a different DL1b or DL2 sub-productions.
# Otherwise, keep it empty to use the common PROD-ID
DL1_PROD_ID: tailcut84
DL2_PROD_ID: tailcut84_model1


[lstchain]
# Calibration
drs4_baseline: lstchain_data_create_drs4_pedestal_file
time_calibration: lstchain_data_create_time_calibration_file
charge_calibration: lstchain_create_calibration_file

# Data processing
r0_to_dl1: lstchain_data_r0_to_dl1
dl1ab: lstchain_dl1ab
check_dl1: lstchain_check_dl1
dl1_to_dl2: lstchain_dl1_to_dl2

# To be set by the user
store_image_dl1ab: True
merge_dl1_datacheck: True
calibration_config: lstchain/data/onsite_camera_calibration_param.json
dl1ab_config: /software/lstchain/data/lstchain_standard_config.json
# In principle both config files should be the same, but in case
# the MC DL2 uses a different config file, it can be set here.
dl2_config: /software/lstchain/data/lstchain_standard_config.json
reference_time_calibration_run: 4211
ffactor_systematics: /path/to/ff_systematics_file.h5
rf_models: /data/models/prod5/zenith_20deg/20201023_v0.6.3

[SLURM]
PARTITION_PEDCALIB: short
PARTITION_DATA: long
MEMSIZE_PEDCALIB: 5GB
MEMSIZE_DATA: 16GB

[WEBSERVER]
# Set the server address and port to transfer the datacheck plots
HOST: datacheck
DATACHECK: /home/www/html/datacheck
INDEXPHP: /fefs/aswg/lstosa/utils/webserver/index.php

[CACHE]
# Sometimes when working with clusters and job schedulers, cache
# directories need to be specified by the user. Otherwise leave them empty.
CTAPIPE_CACHE: /fefs/aswg/lstanalyzer/.ctapipe/ctapipe_cache
CTAPIPE_SVC_PATH: /fefs/aswg/lstanalyzer/.ctapipe/service
MPLCONFIGDIR: /fefs/aswg/lstanalyzer/.cache/matplotlib

[MYSQL]
# Currently in development
SERVER: hostname
USER: username
DATABASE: LST
DAQTABLE: DAQ
SEQUENCETABLE: SEQUENCE
ANALYSISTABLE: ANALYSIS
SUMMARYTABLE: SUMMARY
STORAGETABLE: STORAGE

[ALARM]
MAIL: your@email.com

# From here on, users should not need to change anything.
[PATTERN]
# Prefixes
R0PREFIX: LST-1.1
CALIBPREFIX: calibration.Run
PEDESTALPREFIX: drs4_pedestal.Run
TIMECALIBPREFIX: time_calibration.Run
DL1PREFIX: dl1_LST-1
DL1ABPREFIX: dl1_LST-1
DATACHECKPREFIX: datacheck_dl1_LST-1
MUONPREFIX: muons_LST-1
DL2PREFIX: dl2_LST-1

# Suffixes
R0SUFFIX: .fits.fz
CALIBSUFFIX: .h5
PEDESTALSUFFIX: .fits
TIMECALIBSUFFIX: .h5
DL1SUFFIX: .h5
DL1ABSUFFIX: .h5
DATACHECKSUFFIX: .h5
MUONSUFFIX: .fits
DL2SUFFIX: .h5

# File type pattern for DB
CALIBTYPE = Calibration
TIMECALIBTYPE = TimeCalibration
PEDESTALTYPE = DRS4Pedestal
DL1TYPE = DL1
DL1ABTYPE = DL1
DL2TYPE = DL2
MUONTYPE = Muons
DATACHECKTYPE = Datacheck

[LSTOSA]
GRAPH: dot
WORKFLOWPREFIX: Workflow
GRAPHSUFFIX: .dot
SCRIPTSUFFIX: .py
SVGSUFFIX: .svg
HISTORYSUFFIX: .history
# Amount of tries each datasequence job is allowed to run before being vetoed
MAX_FAIL: 2
end_of_activity: NightFinished.txt

[OUTPUT]
# REPORTWIDTH is the width in characters of the heading frame for the output
REPORTWIDTH: 148
# Number of characters padding the columns
PADDING: 2

[PROVENANCE]
version: 1
formatters:
    simple:
        format: '%(levelname)s %(name)s %(message)s'
        #format: '%(asctime)s.%(msecs)03d%(message)s'
        datefmt: '%Y-%m-%dT%H:%M:%S'
handlers:
    provHandler:
        class: logging.handlers.WatchedFileHandler
        level: INFO
        formatter: simple
        filename: prov.log
loggers:
    provLogger:
        level: INFO
        handlers: [provHandler]
        propagate: False
disable_existing_loggers: False
PREFIX: __PROV__
HASH_METHOD: md5
HASH_BUFFER: path
capture: True
