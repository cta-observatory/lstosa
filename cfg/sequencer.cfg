# Example of a configuration file for the On-Site Analysis (OSA) for
# the LST1 telescope.
#
# The %()s variables are wildcards for string substitutions

[LST1]
# Directories to replicate the LST1 directory tree.
# The BASE and MONITORING need to be set by the user.
BASE: test_osa/test_files0
MONITORING: %(BASE)s/monitoring
# The directories below can be left untouched.
R0_DIR: %(BASE)s/R0
DRIVE_DIR: %(MONITORING)s/DrivePositioning
RUN_SUMMARY_DIR: %(MONITORING)s/RunSummary
ANALYSIS_DIR: %(BASE)s/running_analysis
CALIB_BASE_DIR: %(MONITORING)s/PixelCalibration/LevelA
CALIB_DIR: %(CALIB_BASE_DIR)s/calibration
PEDESTAL_DIR: %(CALIB_BASE_DIR)s/drs4_baseline
TIMECALIB_DIR: %(CALIB_BASE_DIR)s/drs4_time_sampling_from_FF
DL1_DIR: %(BASE)s/DL1
DL1AB_DIR: %(BASE)s/DL1
MUON_DIR: %(BASE)s/DL1
DATACHECK_DIR: %(BASE)s/DL1
DL2_DIR: %(BASE)s/DL2
DL3_DIR: %(BASE)s/DL3
CLOSER_DIR: %(BASE)s/OSA/Closer
LONGTERM_DIR: %(BASE)s/OSA/DL1DataCheck_LongTerm

# To be set by the user. Using PROD-ID will overcome the automatic
# fetching of lstchain version. Otherwise leave it empty (and without the colon symbol).
PROD_ID: v0.1.0
CALIB_PROD_ID: v01
# Change this to produce a different DL1b or DL2 sub-productions.
# Otherwise, keep it empty to use the common PROD-ID
DL1_PROD_ID: tailcut84
DL2_PROD_ID: tailcut84_model1

[lstchain]
# Calibration steps in calibration pipeline script
drs4_baseline: onsite_create_drs4_pedestal_file
charge_calibration: onsite_create_calibration_file

# Data processing steps in datasequence script
r0_to_dl1: lstchain_data_r0_to_dl1
dl1ab: lstchain_dl1ab
check_dl1: lstchain_check_dl1
dl1_to_dl2: lstchain_dl1_to_dl2

# Path to longterm dl1 script
longterm_check: /fefs/aswg/software/virtual_env/ctasoft/cta-lstchain/lstchain/scripts/longterm_dl1_check.py

# To be set by the user
store_image_dl1ab: True
merge_dl1_datacheck: True
dl1ab_config: /software/lstchain/data/lstchain_standard_config.json
# In principle both config files should be the same, but in case
# the MC DL2 uses a different config file, it can be set here.
dl2_config: /software/lstchain/data/lstchain_standard_config.json
rf_models: /data/models/prod5/zenith_20deg/20201023_v0.6.3
dl3_config: /software/lstchain/data/dl3_std_config.json

[IRF]
mc_gamma: /fefs/aswg/data/mc/DL2/20200629_prod5_trans_80/gamma/zenith_20deg/south_pointing/20210923_v0.7.5_prod5_trans_80_dynamic_cleaning/off0.4deg/dl2_gamma_20deg_180deg_off0.4deg_20210923_v0.7.5_prod5_trans_80_dynamic_cleaning_testing.
mc_proton: /fefs/aswg/data/mc/DL2/20200629_prod5_trans_80/proton/zenith_20deg/south_pointing/20210923_v0.7.5_prod5_trans_80_dynamic_cleaning/dl2_proton_20deg_180deg_20210923_v0.7.5_prod5_trans_80_dynamic_cleaning_testing.h5
mc_electron: /fefs/aswg/data/mc/DL2/20200629_prod5_trans_80/electron/zenith_20deg/south_pointing/20210923_v0.7.5_prod5_trans_80_dynamic_cleaning/dl2_electron_20deg_180deg_20210923_v0.7.5_prod5_trans_80_dynamic_cleaning_testing.h5

[SLURM]
PARTITION_PEDCALIB: short
PARTITION_DATA: long
MEMSIZE_PEDCALIB: 3GB
MEMSIZE_DATA: 16GB

[WEBSERVER]
# Set the server address and port to transfer the datacheck plots
HOST: datacheck
DATACHECK: /home/www/html/datacheck
INDEXPHP: /fefs/aswg/lstosa/utils/webserver/index.php

[CACHE]
# Sometimes when working with clusters and job schedulers, cache
# directories need to be specified by the user. Otherwise leave them empty.
CTAPIPE_CACHE: /fefs/aswg/lstanalyzer/.ctapipe/ctapipe_cache
CTAPIPE_SVC_PATH: /fefs/aswg/lstanalyzer/.ctapipe/service
MPLCONFIGDIR: /fefs/aswg/lstanalyzer/.cache/matplotlib

[MYSQL]
# Currently in development
SERVER: hostname
USER: username
DATABASE: LST
DAQTABLE: DAQ
SEQUENCETABLE: SEQUENCE
ANALYSISTABLE: ANALYSIS
SUMMARYTABLE: SUMMARY
STORAGETABLE: STORAGE

[ALARM]
MAIL: your@email.com

# From here on, users should not need to change anything.
[PATTERN]
# Prefixes
R0PREFIX: LST-1.1
CALIBPREFIX: calibration.Run
PEDESTALPREFIX: drs4_pedestal.Run
TIMECALIBPREFIX: time_calibration.Run
DL1PREFIX: dl1_LST-1
DL1ABPREFIX: dl1_LST-1
DATACHECKPREFIX: datacheck_dl1_LST-1
MUONPREFIX: muons_LST-1
DL2PREFIX: dl2_LST-1

# Suffixes
R0SUFFIX: .fits.fz
CALIBSUFFIX: .h5
PEDESTALSUFFIX: .fits
TIMECALIBSUFFIX: .h5
DL1SUFFIX: .h5
DL1ABSUFFIX: .h5
DATACHECKSUFFIX: .h5
MUONSUFFIX: .fits
DL2SUFFIX: .h5

# File type pattern for DB
CALIBTYPE = Calibration
TIMECALIBTYPE = TimeCalibration
PEDESTALTYPE = DRS4Pedestal
DL1TYPE = DL1
DL1ABTYPE = DL1
DL2TYPE = DL2
MUONTYPE = Muons
DATACHECKTYPE = Datacheck

[LSTOSA]
GRAPH: dot
WORKFLOWPREFIX: Workflow
GRAPHSUFFIX: .dot
SVGSUFFIX: .svg
end_of_activity: NightFinished.txt

[OUTPUT]
# REPORTWIDTH is the width in characters of the heading frame for the output
REPORTWIDTH: 160
# Number of characters padding the columns
PADDING: 2

[PROVENANCE]
version: 1
formatters:
    simple:
        format: '%(levelname)s %(name)s %(message)s'
        #format: '%(asctime)s.%(msecs)03d%(message)s'
        datefmt: '%Y-%m-%dT%H:%M:%S'
handlers:
    provHandler:
        class: logging.handlers.WatchedFileHandler
        level: INFO
        formatter: simple
        filename: prov.log
loggers:
    provLogger:
        level: INFO
        handlers: [provHandler]
        propagate: False
disable_existing_loggers: False
PREFIX: __PROV__
HASH_METHOD: md5
HASH_BUFFER: path
capture: True
